<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OBEARCO ‚Ä¢ Gate of Accounts</title>
  <meta name="color-scheme" content="dark" />
  <style>
    :root{
      --bg0:#07070b;
      --bg1:#0b0b12;
      --panel:#0f111a;
      --panel2:#0b0d14;
      --glass: rgba(18, 20, 31, .55);
      --glass2: rgba(10, 12, 20, .45);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.06);

      --txt:#e9e9f4;
      --muted:#a9a9c4;

      --gold:#e1c46b;
      --gold2:#b88f2e;
      --cyan:#59f1ff;
      --violet:#a78bfa;
      --pink:#ff4fd8;
      --red:#ff4a4a;
      --green:#52ffa1;

      --shadow: 0 16px 64px rgba(0,0,0,.55);
      --shadow2: 0 10px 40px rgba(0,0,0,.35);

      --r: 22px;
      --r2: 16px;
      --pad: 18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--txt);
      background: radial-gradient(1000px 600px at 35% 25%, rgba(167,139,250,.15), transparent 60%),
                  radial-gradient(900px 520px at 75% 30%, rgba(89,241,255,.10), transparent 60%),
                  radial-gradient(800px 520px at 55% 80%, rgba(255,79,216,.08), transparent 60%),
                  linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
    }

    /* ---------- AAA VFX BACKGROUND ---------- */
    .vfx{
      position:fixed; inset:0;
      pointer-events:none;
      overflow:hidden;
    }
    .stars{
      position:absolute; inset:-20%;
      background-image:
        radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.25), transparent 40%),
        radial-gradient(1px 1px at 45% 70%, rgba(255,255,255,.25), transparent 40%),
        radial-gradient(1px 1px at 75% 25%, rgba(255,255,255,.22), transparent 40%),
        radial-gradient(2px 2px at 60% 45%, rgba(255,255,255,.18), transparent 40%),
        radial-gradient(1px 1px at 30% 85%, rgba(255,255,255,.18), transparent 40%),
        radial-gradient(2px 2px at 85% 80%, rgba(255,255,255,.15), transparent 40%);
      filter: blur(.2px);
      opacity:.9;
      animation: drift 18s linear infinite;
      transform: translate3d(0,0,0);
    }
    @keyframes drift{
      0%{transform: translate3d(0,0,0) scale(1)}
      50%{transform: translate3d(-2%,1%,0) scale(1.03)}
      100%{transform: translate3d(0,0,0) scale(1)}
    }

    .nebula{
      position:absolute; inset:-25%;
      background:
        radial-gradient(700px 360px at 30% 25%, rgba(167,139,250,.20), transparent 62%),
        radial-gradient(800px 380px at 68% 30%, rgba(89,241,255,.16), transparent 62%),
        radial-gradient(900px 420px at 55% 80%, rgba(255,79,216,.12), transparent 62%);
      filter: blur(10px);
      opacity:.8;
      animation: breathe 9s ease-in-out infinite;
    }
    @keyframes breathe{
      0%,100%{transform: scale(1)}
      50%{transform: scale(1.05)}
    }

    .runes{
      position:absolute; inset:0;
      background-image:
        linear-gradient(90deg, transparent, rgba(225,196,107,.05), transparent),
        linear-gradient(0deg, transparent, rgba(89,241,255,.04), transparent);
      background-size: 420px 420px, 520px 520px;
      background-position: 0 0, 120px 220px;
      mask-image: radial-gradient(closest-side at 55% 40%, rgba(0,0,0,.95), transparent 75%);
      opacity:.75;
      animation: runes 14s linear infinite;
    }
    @keyframes runes{
      0%{transform: translate3d(0,0,0)}
      100%{transform: translate3d(-4%,2%,0)}
    }

    .comets{
      position:absolute; inset:0;
      opacity:.9;
      filter: blur(.4px);
    }
    .comet{
      position:absolute;
      width:240px; height:2px;
      background: linear-gradient(90deg, transparent, rgba(225,196,107,.35), rgba(255,255,255,.25), transparent);
      transform: rotate(-22deg);
      border-radius: 999px;
      animation: comet 3.6s linear infinite;
      mix-blend-mode: screen;
    }
    .comet:nth-child(1){top:18%; left:-20%; animation-delay: .3s}
    .comet:nth-child(2){top:44%; left:-35%; animation-delay: 1.1s; width:320px}
    .comet:nth-child(3){top:72%; left:-25%; animation-delay: 2.2s; width:280px}
    @keyframes comet{
      0%{transform: translateX(0) rotate(-22deg); opacity:0}
      10%{opacity:.9}
      60%{opacity:.65}
      100%{transform: translateX(160vw) rotate(-22deg); opacity:0}
    }

    /* ---------- LAYOUT ---------- */
    .wrap{
      height:100%;
      display:grid;
      grid-template-columns: 300px 1fr 360px;
      gap: 18px;
      padding: 18px;
    }

    .card{
      background: linear-gradient(180deg, rgba(16,18,28,.80), rgba(10,11,18,.72));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      border-radius: var(--r);
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(800px 240px at 20% 0%, rgba(225,196,107,.10), transparent 60%),
                  radial-gradient(820px 260px at 90% 5%, rgba(167,139,250,.12), transparent 60%),
                  radial-gradient(680px 260px at 65% 100%, rgba(89,241,255,.08), transparent 60%);
      pointer-events:none;
      filter: blur(0px);
      opacity:.9;
    }
    .card > *{position:relative; z-index:1}

    .left{
      padding: 18px;
      display:flex;
      flex-direction:column;
      gap: 14px;
    }

    .brand{
      display:flex; align-items:center; gap: 12px;
      padding: 8px 6px 0 6px;
    }
    .orb{
      width:42px; height:42px; border-radius: 14px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 45%),
        radial-gradient(circle at 70% 65%, rgba(255,79,216,.25), transparent 55%),
        radial-gradient(circle at 50% 50%, rgba(89,241,255,.18), rgba(167,139,250,.12) 55%, rgba(0,0,0,.12));
      box-shadow: 0 0 0 1px rgba(255,255,255,.14), 0 18px 60px rgba(167,139,250,.18);
    }
    .brand h1{
      margin:0;
      font-size: 14px;
      letter-spacing: .18em;
      text-transform: uppercase;
      line-height: 1.1;
    }
    .brand p{
      margin:4px 0 0 0;
      font-size: 12px;
      color: var(--muted);
      opacity:.95;
    }

    .nav{
      display:flex; flex-direction:column; gap: 10px;
      margin-top: 8px;
    }
    .navbtn{
      width:100%;
      text-align:left;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid var(--stroke2);
      color: var(--txt);
      padding: 14px 14px;
      border-radius: 16px;
      cursor:pointer;
      box-shadow: var(--shadow2);
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px;
    }
    .navbtn:hover{transform: translateY(-1px); border-color: rgba(225,196,107,.25)}
    .navbtn.active{
      border-color: rgba(225,196,107,.38);
      background: linear-gradient(180deg, rgba(225,196,107,.14), rgba(255,255,255,.03));
    }
    .navbtn .t{display:flex; flex-direction:column}
    .navbtn .t b{font-size: 18px; letter-spacing:.02em}
    .navbtn .t small{color: var(--muted); margin-top:2px}
    .pill{
      font-size: 12px;
      color: rgba(255,255,255,.9);
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      padding: 6px 10px;
      border-radius: 999px;
    }

    .mid{
      padding: 16px;
      display:flex;
      flex-direction:column;
      gap: 14px;
      overflow:hidden;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 12px 14px;
      border-radius: var(--r2);
      border: 1px solid var(--stroke2);
      background: rgba(0,0,0,.18);
    }
    .topbar .meta{
      display:flex;
      flex-direction:column;
      gap: 2px;
      min-width: 0;
    }
    .topbar .meta .title{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }
    .topbar .meta .title b{
      font-size: 13px;
      letter-spacing: .18em;
      text-transform: uppercase;
      white-space:nowrap;
    }
    .topbar .meta .sub{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .actions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }

    .btn{
      border: 1px solid var(--stroke2);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      color: var(--txt);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, filter .12s ease;
      box-shadow: 0 10px 28px rgba(0,0,0,.24);
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap: 8px;
      font-weight: 650;
      letter-spacing:.01em;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(89,241,255,.30)}
    .btn.gold{
      border-color: rgba(225,196,107,.32);
      background: linear-gradient(180deg, rgba(225,196,107,.18), rgba(255,255,255,.03));
    }
    .btn.red{
      border-color: rgba(255,74,74,.32);
      background: linear-gradient(180deg, rgba(255,74,74,.12), rgba(255,255,255,.03));
    }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
      filter: grayscale(.2);
    }

    .panel{
      border: 1px solid var(--stroke2);
      border-radius: var(--r);
      background: rgba(0,0,0,.18);
      padding: 14px;
      overflow:hidden;
      min-height: 0;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .panelHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 4px 4px 8px 4px;
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .panelHead .h{
      display:flex; flex-direction:column; gap: 2px;
    }
    .panelHead .h b{
      font-size: 16px;
      letter-spacing:.08em;
      text-transform: uppercase;
    }
    .panelHead .h small{color:var(--muted)}
    .statusBadge{
      display:flex; align-items:center; gap: 8px;
      font-size: 12px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.9);
      white-space:nowrap;
    }
    .dot{
      width:10px; height:10px;
      border-radius: 99px;
      background: rgba(255,255,255,.3);
      box-shadow: 0 0 0 1px rgba(255,255,255,.12);
    }
    .dot.on{background: rgba(82,255,161,.85); box-shadow: 0 0 18px rgba(82,255,161,.22), 0 0 0 1px rgba(82,255,161,.3)}
    .dot.off{background: rgba(255,74,74,.85); box-shadow: 0 0 18px rgba(255,74,74,.18), 0 0 0 1px rgba(255,74,74,.3)}

    /* --- SCROLL da √°rea circulada (PORTAL CONTENT) --- */
    .portalScroll{
      min-height: 0;
      flex: 1;
      overflow:auto;
      padding-right: 6px;
      scrollbar-gutter: stable;
    }
    .portalScroll::-webkit-scrollbar{width:10px}
    .portalScroll::-webkit-scrollbar-thumb{
      background: linear-gradient(180deg, rgba(225,196,107,.22), rgba(167,139,250,.14));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 999px;
    }
    .portalScroll::-webkit-scrollbar-track{
      background: rgba(0,0,0,.25);
      border-radius: 999px;
    }

    .portalHero{
      border-radius: var(--r);
      border: 1px solid rgba(255,255,255,.08);
      background:
        radial-gradient(800px 260px at 12% 20%, rgba(225,196,107,.18), transparent 58%),
        radial-gradient(800px 260px at 85% 15%, rgba(167,139,250,.16), transparent 58%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.18));
      padding: 16px;
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      position:relative;
      overflow:hidden;
    }
    .portalHero::after{
      content:"";
      position:absolute; inset:-40%;
      background: conic-gradient(from 180deg, rgba(255,79,216,.10), rgba(89,241,255,.10), rgba(225,196,107,.12), rgba(167,139,250,.10), rgba(255,79,216,.10));
      filter: blur(18px);
      opacity:.25;
      animation: spin 10s linear infinite;
    }
    @keyframes spin{
      0%{transform: rotate(0deg)}
      100%{transform: rotate(360deg)}
    }
    .portalHero > *{position:relative; z-index:1}
    .portalHeroTop{
      display:flex; align-items:center; justify-content:space-between; gap: 12px; flex-wrap:wrap;
    }
    .portalHeroTop .lefty{
      display:flex; align-items:center; gap: 10px;
    }
    .swords{
      font-size: 22px;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.45));
    }
    .portalHero h2{
      margin:0;
      font-size: 22px;
      letter-spacing:.02em;
    }
    .portalHero p{
      margin: 4px 0 0 0;
      color: var(--muted);
    }

    /* S√≥ 2 bot√µes (Login/Registro) */
    .seg2{
      display:flex; gap: 10px;
      padding: 10px;
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.20);
      border-radius: 16px;
    }
    .seg2 .btn{flex:1; justify-content:center}

    .form{
      margin-top: 12px;
      border-radius: var(--r);
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.20);
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .grid1{display:grid; grid-template-columns: 1fr; gap:10px}
    .field{
      display:flex; flex-direction:column; gap: 6px;
    }
    .field label{
      font-size: 12px;
      color: rgba(255,255,255,.72);
      letter-spacing:.06em;
      text-transform: uppercase;
    }
    input, textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--txt);
      outline:none;
      transition: border-color .12s ease, background .12s ease;
    }
    input:focus, textarea:focus{
      border-color: rgba(89,241,255,.35);
      background: rgba(255,255,255,.08);
    }
    textarea{min-height: 110px; resize: vertical}

    .formActions{
      display:flex; gap: 10px; flex-wrap:wrap;
      margin-top: 4px;
    }

    .hr{
      height:1px;
      background: rgba(255,255,255,.06);
      margin: 10px 0;
    }

    .right{
      padding: 16px;
      display:flex;
      flex-direction:column;
      gap: 14px;
      overflow:hidden;
    }

    .noteBox{
      border-radius: var(--r);
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.18);
      padding: 14px;
      overflow:auto;
      min-height: 0;
    }
    .noteBox h3{
      margin:0;
      font-size: 20px;
      display:flex; align-items:center; gap: 10px;
    }
    .noteBox p, .noteBox li{
      color: var(--muted);
      line-height:1.45;
      font-size: 13px;
    }
    .noteBox ul{padding-left: 16px}
    .noteBox .stamp{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(255,255,255,.65);
      border-top: 1px solid rgba(255,255,255,.06);
      padding-top: 10px;
    }

    /* content sections (tabs) */
    .section{
      display:none;
      min-height: 0;
      overflow:hidden;
    }
    .section.active{display:flex; flex-direction:column; gap: 12px; min-height:0}

    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      padding: 2px 8px;
      border-radius: 999px;
      color: rgba(255,255,255,.85);
    }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      color: rgba(255,255,255,.85);
    }

    .toastWrap{
      position: fixed;
      right: 16px;
      bottom: 16px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      pointer-events:none;
      z-index: 50;
    }
    .toast{
      pointer-events:none;
      max-width: 420px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.55);
      box-shadow: 0 20px 70px rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      animation: toastIn .22s ease-out;
    }
    @keyframes toastIn{
      from{transform: translateY(10px); opacity:0}
      to{transform: translateY(0); opacity:1}
    }
    .toast b{display:block; margin-bottom:4px}
    .toast small{color: var(--muted)}

    .list{
      display:flex; flex-direction:column; gap: 8px;
    }
    .row{
      display:flex; align-items:center; justify-content:space-between; gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.04);
    }
    .row b{font-size: 13px}
    .row small{color: var(--muted)}

    .hint{
      font-size: 12px;
      color: var(--muted);
    }

    /* responsive */
    @media (max-width: 1180px){
      body{overflow:auto}
      .wrap{
        height:auto;
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="vfx" aria-hidden="true">
    <div class="stars"></div>
    <div class="nebula"></div>
    <div class="runes"></div>
    <div class="comets">
      <div class="comet"></div>
      <div class="comet"></div>
      <div class="comet"></div>
    </div>
  </div>

  <div class="wrap">
    <!-- LEFT -->
    <aside class="card left">
      <div class="brand">
        <div class="orb"></div>
        <div>
          <h1>OBEARCO ‚Ä¢ Gate of Accounts</h1>
          <p id="pConnected">Conectado ao portal: <span class="mono" id="apiBaseLabel">‚Äî</span></p>
        </div>
      </div>

      <div class="nav" role="tablist" aria-label="Abas">
        <button class="navbtn active" data-tab="portal">
          <span class="t"><b>Portal</b><small>login / registro</small></span>
          <span class="pill">üóùÔ∏è</span>
        </button>
        <button class="navbtn" data-tab="taverna">
          <span class="t"><b>Taverna</b><small>nicks registrados</small></span>
          <span class="pill">üç∫</span>
        </button>
        <button class="navbtn" data-tab="perfil">
          <span class="t"><b>Perfil</b><small>token / dados</small></span>
          <span class="pill">üõ°Ô∏è</span>
        </button>
        <button class="navbtn" data-tab="conta">
          <span class="t"><b>Conta</b><small>editar / deletar</small></span>
          <span class="pill">‚öôÔ∏è</span>
        </button>
      </div>

      <div class="panel" style="margin-top:auto">
        <div class="panelHead">
          <div class="h">
            <b>API / Token</b>
            <small>Base atual: <span class="mono" id="apiBaseSmall">‚Äî</span></small>
          </div>
          <span class="statusBadge"><span class="dot off" id="dotApi"></span><span id="apiStatusTxt">desconhecido</span></span>
        </div>

        <div class="grid1">
          <div class="field">
            <label>Base manual (fallback)</label>
            <input id="apiBaseInput" placeholder="ex: https://xxxx.ngrok-free.dev" />
            <div class="hint">Dica: clique <span class="kbd">Sync status.json</span> pra puxar do arquivo.</div>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap">
            <button class="btn" id="btnApplyBase">‚úÖ Aplicar base</button>
            <button class="btn" id="btnClearToken">üßπ Limpar token</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- MIDDLE -->
    <main class="card mid">
      <div class="topbar">
        <div class="meta">
          <div class="title">
            <div class="orb" style="width:34px;height:34px;border-radius:12px"></div>
            <b>OBEARCO ‚Ä¢ Gate of Accounts</b>
          </div>
          <div class="sub">
            Conectado ao portal: <span class="mono" id="apiBaseTop">‚Äî</span>
          </div>
        </div>

        <div class="actions">
          <button class="btn" id="btnSyncStatus">üîÑ Sync status.json</button>
          <button class="btn" id="btnPing">‚òê Ping</button>
          <button class="btn" id="btnWhoami">üëÅÔ∏è Whoami</button>
        </div>
      </div>

      <!-- SECTIONS -->
      <section class="section active" id="tab-portal">
        <div class="panel">
          <div class="panelHead">
            <div class="h">
              <b>PORTAL</b>
              <small>Login/Registro usando <span class="kbd">/api/v1/cmd</span>. (Base vem do <span class="kbd">server_status.json</span>)</small>
            </div>
            <span class="statusBadge"><span class="dot" id="dotSrv"></span><span id="srvTxt">status: ‚Äî</span></span>
          </div>

          <!-- SCROLL AREA (A CIRCULADA) -->
          <div class="portalScroll">
            <div class="portalHero">
              <div class="portalHeroTop">
                <div class="lefty">
                  <div class="swords">‚öîÔ∏è</div>
                  <div>
                    <h2>Portal do Aventureiro</h2>
                    <p>Escolha <b>Login</b> ou <b>Registro</b> e forje sua entrada no reino.</p>
                  </div>
                </div>
                <div class="seg2" role="tablist" aria-label="Login ou Registro">
                  <button class="btn gold" id="btnShowLogin" aria-selected="true">üóùÔ∏è Login</button>
                  <button class="btn" id="btnShowRegister" aria-selected="false">üßæ Registro</button>
                </div>
              </div>
            </div>

            <!-- LOGIN VIEW -->
            <div class="form" id="viewLogin">
              <div style="display:flex; align-items:flex-end; justify-content:space-between; gap:12px; flex-wrap:wrap">
                <div>
                  <h3 style="margin:0 0 4px 0">Login</h3>
                  <div class="hint">Use <b>username</b> ou <b>email</b> no campo <span class="kbd">login</span>.</div>
                </div>
                <div class="hint">Comando: <span class="kbd">/login</span></div>
              </div>

              <div class="grid2">
                <div class="field">
                  <label>Login (email ou username)</label>
                  <input id="login_login" placeholder="ex: Gustavo ou gustavo@email.com" autocomplete="username" />
                </div>
                <div class="field">
                  <label>Senha</label>
                  <input id="login_senha" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
                </div>
              </div>

              <div class="formActions">
                <button class="btn gold" id="btnDoLogin">üóùÔ∏è Entrar</button>
                <button class="btn" id="btnLogout">üö™ Logout</button>
              </div>

              <div class="hr"></div>

              <div class="hint">
                Ao logar, o token ser√° salvo e voc√™ poder√° copi√°-lo na aba <b>Perfil</b>.
              </div>
            </div>

            <!-- REGISTER VIEW -->
            <div class="form" id="viewRegister" style="display:none">
              <div style="display:flex; align-items:flex-end; justify-content:space-between; gap:12px; flex-wrap:wrap">
                <div>
                  <h3 style="margin:0 0 4px 0">Registro</h3>
                  <div class="hint">Cria conta na tabela <span class="kbd">contas</span>.</div>
                </div>
                <div class="hint">Comando: <span class="kbd">/register</span></div>
              </div>

              <div class="grid2">
                <div class="field">
                  <label>Username</label>
                  <input id="reg_username" placeholder="ex: Gustavo_42" autocomplete="username" />
                </div>
                <div class="field">
                  <label>Email</label>
                  <input id="reg_email" placeholder="ex: voce@email.com" autocomplete="email" />
                </div>
              </div>

              <div class="grid1">
                <div class="field">
                  <label>Senha</label>
                  <input id="reg_senha" type="password" placeholder="m√≠nimo 6 chars" autocomplete="new-password" />
                </div>
              </div>

              <div class="formActions">
                <button class="btn gold" id="btnDoRegister">üßæ Registrar</button>
              </div>

              <div class="hr"></div>
              <div class="hint">
                Depois de registrar, voc√™ pode fazer login aqui mesmo.
              </div>
            </div>

            <div class="panel" style="margin-top:12px">
              <div class="panelHead">
                <div class="h">
                  <b>Debug r√°pido</b>
                  <small>Verifica conectividade e sess√£o</small>
                </div>
              </div>
              <div style="display:flex; gap:10px; flex-wrap:wrap">
                <button class="btn" id="btnListUsers1">üìú /listusers</button>
                <button class="btn" id="btnWhoami2">üëÅÔ∏è /whoami</button>
                <button class="btn" id="btnPing2">‚òê /ping</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="section" id="tab-taverna">
        <div class="panel">
          <div class="panelHead">
            <div class="h">
              <b>TAVERNA</b>
              <small>Feed com usernames registrados (<span class="kbd">/listusers</span>)</small>
            </div>
            <button class="btn gold" id="btnListUsers">‚ú® Atualizar</button>
          </div>

          <div class="list" id="usersList">
            <div class="row"><b>‚Äî</b><small>clique em ‚ÄúAtualizar‚Äù</small></div>
          </div>
        </div>
      </section>

      <section class="section" id="tab-perfil">
        <div class="panel">
          <div class="panelHead">
            <div class="h">
              <b>PERFIL</b>
              <small>Token vis√≠vel + dados da sess√£o</small>
            </div>
          </div>

          <div class="grid1">
            <div class="field">
              <label>Token de login (session_token)</label>
              <input id="tokenField" readonly />
              <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:8px">
                <button class="btn gold" id="btnCopyToken">üìã Copiar token</button>
                <button class="btn" id="btnWhoami3">üëÅÔ∏è Atualizar whoami</button>
              </div>
              <div class="hint">O site envia o token como <span class="kbd">Authorization: Bearer &lt;token&gt;</span></div>
            </div>

            <div class="field">
              <label>Whoami (retorno)</label>
              <textarea id="whoamiBox" readonly></textarea>
            </div>
          </div>
        </div>
      </section>

      <section class="section" id="tab-conta">
        <div class="panel">
          <div class="panelHead">
            <div class="h">
              <b>CONTA</b>
              <small>Editar email/nome, trocar senha e deletar</small>
            </div>
          </div>

          <div class="form">
            <h3 style="margin:0">Editar Perfil</h3>
            <div class="hint">Comando: <span class="kbd">/updateprofile</span></div>
            <div class="grid2">
              <div class="field">
                <label>Novo username</label>
                <input id="up_username" placeholder="(opcional)" />
              </div>
              <div class="field">
                <label>Novo email</label>
                <input id="up_email" placeholder="(opcional)" />
              </div>
            </div>
            <div class="formActions">
              <button class="btn gold" id="btnUpdateProfile">üíæ Salvar</button>
            </div>
          </div>

          <div class="form">
            <h3 style="margin:0">Trocar Senha</h3>
            <div class="hint">Comando: <span class="kbd">/changepassword</span></div>
            <div class="grid2">
              <div class="field">
                <label>Senha atual</label>
                <input id="cp_old" type="password" />
              </div>
              <div class="field">
                <label>Senha nova</label>
                <input id="cp_new" type="password" />
              </div>
            </div>
            <div class="formActions">
              <button class="btn gold" id="btnChangePassword">üîë Alterar senha</button>
            </div>
          </div>

          <div class="form" style="border-color: rgba(255,74,74,.22)">
            <h3 style="margin:0; color: rgba(255,200,200,.95)">Deletar Conta</h3>
            <div class="hint">Comando: <span class="kbd">/deleteaccount</span> (exige senha atual)</div>

            <div class="grid2">
              <div class="field">
                <label>Senha atual</label>
                <input id="del_pass" type="password" />
              </div>
              <div class="field">
                <label>Confirma√ß√£o</label>
                <input id="del_confirm" placeholder='digite: DELETAR' />
              </div>
            </div>

            <div class="row" style="background: rgba(255,74,74,.06); border-color: rgba(255,74,74,.18)">
              <div>
                <b>‚ö†Ô∏è A√ß√£o irrevers√≠vel</b>
                <small>Ao confirmar, o bot√£o libera depois de 5 segundos.</small>
              </div>
              <div class="mono" id="delTimer">‚Äî</div>
            </div>

            <div class="formActions">
              <button class="btn red" id="btnArmDelete">‚ö†Ô∏è Preparar dele√ß√£o</button>
              <button class="btn red" id="btnDeleteAccount" disabled>üóëÔ∏è Confirmar deletar</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- RIGHT -->
    <aside class="card right">
      <div class="panelHead" style="padding: 8px 10px">
        <div class="h">
          <b>PATCH NOTES</b>
          <small>lado fixo ‚Ä¢ estilo ‚Äúsite AAA‚Äù</small>
        </div>
        <button class="btn gold" id="btnRefreshNotes">‚ú® Atualizar</button>
      </div>

      <div class="noteBox" id="notesBox">
        <h3>üêß Cr√¥nicas do Reino</h3>
        <p>Essa coluna sempre fica do lado. Voc√™ pode trocar o texto quando quiser.</p>

        <ul>
          <li>Portal de contas (medieval/anime) + VFX</li>
          <li>√Årea do Portal com scroll</li>
          <li>Switch Login/Registro com 2 bot√µes</li>
          <li>Token vis√≠vel + copiar</li>
          <li>Delete com delay 5s</li>
          <li>Feed de nicks: <span class="kbd">/listusers</span></li>
        </ul>

        <div class="stamp" id="notesStamp">Atualizado em ‚Äî</div>
      </div>
    </aside>
  </div>

  <div class="toastWrap" id="toastWrap"></div>

  <script>
    // =========================
    // CONFIG / STATE
    // =========================
    const LS_BASE  = "obearco_api_base";
    const LS_TOKEN = "obearco_token";

    let apiBase = "";
    let token = "";

    const el = (id) => document.getElementById(id);

    function toast(title, msg){
      const w = el("toastWrap");
      const t = document.createElement("div");
      t.className = "toast";
      t.innerHTML = `<b>${escapeHtml(title)}</b><small>${escapeHtml(msg || "")}</small>`;
      w.appendChild(t);
      setTimeout(()=>{ t.style.opacity = "0"; t.style.transform = "translateY(6px)"; }, 2400);
      setTimeout(()=>{ t.remove(); }, 2900);
    }

    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function normalizeBase(u){
      u = String(u||"").trim();
      if(!u) return "";
      u = u.replace(/\/+$/,"");
      return u;
    }

    function setBase(u){
      apiBase = normalizeBase(u);
      localStorage.setItem(LS_BASE, apiBase);
      renderBase();
    }

    function setToken(t){
      token = String(t||"").trim();
      if(token) localStorage.setItem(LS_TOKEN, token);
      else localStorage.removeItem(LS_TOKEN);
      renderToken();
    }

    function renderBase(){
      el("apiBaseLabel").textContent = apiBase || "‚Äî";
      el("apiBaseSmall").textContent = apiBase || "‚Äî";
      el("apiBaseTop").textContent = apiBase || "‚Äî";
      el("apiBaseInput").value = apiBase || "";
    }

    function renderToken(){
      el("tokenField").value = token || "";
    }

    function setApiDot(ok){
      const d = el("dotApi");
      if(ok === true){
        d.classList.add("on"); d.classList.remove("off");
        el("apiStatusTxt").textContent = "ok";
      } else if(ok === false){
        d.classList.add("off"); d.classList.remove("on");
        el("apiStatusTxt").textContent = "falha";
      } else {
        d.classList.remove("on"); d.classList.remove("off");
        el("apiStatusTxt").textContent = "desconhecido";
      }
    }

    function setSrvStatus(statusText){
      const s = String(statusText||"‚Äî");
      el("srvTxt").textContent = "status: " + s;
      const d = el("dotSrv");
      d.classList.remove("on","off");
      if(s.toLowerCase().includes("online")) d.classList.add("on");
      else if(s !== "‚Äî") d.classList.add("off");
    }

    // =========================
    // server_status.json
    // =========================
    async function syncStatusJson(){
      // importante: mesmo diret√≥rio do index.html
      const url = "./server_status.json?ts=" + Date.now();
      try{
        const r = await fetch(url, { cache: "no-store" });
        if(!r.ok) throw new Error("HTTP " + r.status);
        const j = await r.json();

        // Compat: aceita seus campos
        const base = j.url_api_base || j.url || j.PUBLIC_BASE_URL || "";
        const st = j.status_servidor || j.status || "‚Äî";

        if(base) setBase(base);
        setSrvStatus(st);

        toast("Sync status.json", "OK ‚Ä¢ base atualizada");
        return true;
      }catch(e){
        toast("Sync status.json", "Falhou: " + (e?.message || e));
        return false;
      }
    }

    // =========================
    // API CALL (/api/v1/cmd)
    // =========================
    async function apiCmd(payload){
      if(!apiBase){
        toast("Sem base", "Defina a base ou use Sync status.json");
        throw new Error("API base vazia");
      }
      const url = apiBase + "/api/v1/cmd";
      const headers = { "Content-Type": "application/json" };
      if(token) headers["Authorization"] = "Bearer " + token;

      const r = await fetch(url, {
        method: "POST",
        headers,
        body: JSON.stringify(payload || {}),
      });

      let data = null;
      try{ data = await r.json(); }catch(_){}

      if(!r.ok){
        const msg = (data && (data.error || data.message)) ? (data.error || data.message) : ("HTTP " + r.status);
        throw new Error(msg);
      }
      if(data && data.ok === false){
        throw new Error(data.error || "Erro");
      }
      return data;
    }

    // =========================
    // Tabs
    // =========================
    function selectTab(name){
      document.querySelectorAll(".navbtn").forEach(b=>{
        b.classList.toggle("active", b.dataset.tab === name);
      });
      document.querySelectorAll(".section").forEach(s=>{
        s.classList.toggle("active", s.id === "tab-" + name);
      });
    }

    // =========================
    // Portal internal switch (Login/Registro)
    // =========================
    function showPortal(mode){
      const isLogin = mode === "login";
      el("viewLogin").style.display = isLogin ? "" : "none";
      el("viewRegister").style.display = isLogin ? "none" : "";

      const a = el("btnShowLogin");
      const b = el("btnShowRegister");
      a.classList.toggle("gold", isLogin);
      b.classList.toggle("gold", !isLogin);
      a.setAttribute("aria-selected", isLogin ? "true" : "false");
      b.setAttribute("aria-selected", !isLogin ? "true" : "false");
    }

    // =========================
    // Actions
    // =========================
    async function doPing(){
      try{
        const out = await apiCmd({ comando: "/ping" });
        setApiDot(true);
        toast("Ping", "pong=" + out.pong + " ‚Ä¢ ts=" + out.ts);
      }catch(e){
        setApiDot(false);
        toast("Ping", e.message || String(e));
      }
    }

    async function doWhoami(writeBox=true){
      try{
        const out = await apiCmd({ comando: "/whoami" });
        setApiDot(true);
        if(writeBox){
          el("whoamiBox").value = JSON.stringify(out, null, 2);
        }
        toast("Whoami", "OK");
        return out;
      }catch(e){
        setApiDot(false);
        toast("Whoami", e.message || String(e));
        if(writeBox) el("whoamiBox").value = "";
        return null;
      }
    }

    async function doLogin(){
      const login = el("login_login").value.trim();
      const senha = el("login_senha").value.trim();
      if(!login || !senha){
        toast("Login", "Preencha login e senha");
        return;
      }
      try{
        const out = await apiCmd({ comando: "/login", login, senha });
        setApiDot(true);
        if(out.session_token) setToken(out.session_token);
        el("whoamiBox").value = JSON.stringify(out, null, 2);
        toast("Login", "OK ‚Ä¢ token salvo");
      }catch(e){
        setApiDot(false);
        toast("Login", e.message || String(e));
      }
    }

    async function doRegister(){
      const username = el("reg_username").value.trim();
      const email = el("reg_email").value.trim();
      const senha = el("reg_senha").value.trim();
      if(!username || !email || !senha){
        toast("Registro", "Preencha username, email e senha");
        return;
      }
      try{
        const out = await apiCmd({ comando: "/register", username, email, senha });
        setApiDot(true);
        toast("Registro", out.message || "Conta criada");
        // opcional: j√° joga pro login
        showPortal("login");
        el("login_login").value = email || username;
        el("login_senha").value = senha;
      }catch(e){
        setApiDot(false);
        toast("Registro", e.message || String(e));
      }
    }

    async function doLogout(){
      try{
        const out = await apiCmd({ comando: "/logout" });
        toast("Logout", out.message || "OK");
        setToken("");
        el("whoamiBox").value = "";
      }catch(e){
        toast("Logout", e.message || String(e));
      }
    }

    async function listUsers(){
      const box = el("usersList");
      box.innerHTML = `<div class="row"><b>Carregando‚Ä¶</b><small>buscando /listusers</small></div>`;
      try{
        const out = await apiCmd({ comando: "/listusers", limit: 200 });
        const users = (out.users || []);
        if(!users.length){
          box.innerHTML = `<div class="row"><b>Vazio</b><small>nenhum usu√°rio</small></div>`;
          return;
        }
        box.innerHTML = "";
        for(const u of users){
          const row = document.createElement("div");
          row.className = "row";
          row.innerHTML = `<b>${escapeHtml(u.username ?? "‚Äî")}</b><small>#${escapeHtml(u.conta_id ?? "")}</small>`;
          box.appendChild(row);
        }
        toast("Taverna", "OK ‚Ä¢ " + users.length + " nicks");
      }catch(e){
        box.innerHTML = `<div class="row"><b>Erro</b><small>${escapeHtml(e.message || String(e))}</small></div>`;
        toast("Taverna", e.message || String(e));
      }
    }

    async function updateProfile(){
      const username = el("up_username").value.trim();
      const email = el("up_email").value.trim();
      if(!username && !email){
        toast("Perfil", "Nada para atualizar");
        return;
      }
      try{
        const out = await apiCmd({ comando: "/updateprofile", username: username || undefined, email: email || undefined });
        toast("Perfil", out.message || "Atualizado");
        await doWhoami(true);
      }catch(e){
        toast("Perfil", e.message || String(e));
      }
    }

    async function changePassword(){
      const senha_atual = el("cp_old").value.trim();
      const senha_nova = el("cp_new").value.trim();
      if(!senha_atual || !senha_nova){
        toast("Senha", "Preencha senha atual e nova");
        return;
      }
      try{
        const out = await apiCmd({ comando: "/changepassword", senha_atual, senha_nova });
        toast("Senha", out.message || "Alterada");
        el("cp_old").value = "";
        el("cp_new").value = "";
      }catch(e){
        toast("Senha", e.message || String(e));
      }
    }

    // delete flow (5s)
    let delArmed = false;
    let delEnd = 0;
    let delTick = null;

    function resetDeleteUI(){
      delArmed = false;
      delEnd = 0;
      if(delTick){ clearInterval(delTick); delTick = null; }
      el("btnDeleteAccount").disabled = true;
      el("delTimer").textContent = "‚Äî";
    }

    function armDelete(){
      const pass = el("del_pass").value.trim();
      const conf = el("del_confirm").value.trim();
      if(!pass){
        toast("Deletar", "Informe a senha atual");
        return;
      }
      if(conf !== "DELETAR"){
        toast("Deletar", 'Digite exatamente: DELETAR');
        return;
      }
      delArmed = true;
      delEnd = Date.now() + 5000;
      el("btnDeleteAccount").disabled = true;

      if(delTick) clearInterval(delTick);
      delTick = setInterval(()=>{
        const left = Math.max(0, delEnd - Date.now());
        const s = Math.ceil(left / 1000);
        el("delTimer").textContent = left > 0 ? ("libera em " + s + "s") : "liberado";
        if(left <= 0){
          el("btnDeleteAccount").disabled = false;
          clearInterval(delTick);
          delTick = null;
          toast("Deletar", "Bot√£o liberado. Confirme agora.");
        }
      }, 180);
    }

    async function deleteAccount(){
      if(!delArmed){
        toast("Deletar", "Clique em ‚ÄúPreparar dele√ß√£o‚Äù primeiro");
        return;
      }
      if(Date.now() < delEnd){
        toast("Deletar", "Aguarde o contador terminar");
        return;
      }
      const senha_atual = el("del_pass").value.trim();
      try{
        const out = await apiCmd({ comando: "/deleteaccount", senha_atual });
        toast("Deletar", out.message || "Conta deletada");
        setToken("");
        el("whoamiBox").value = "";
        el("del_pass").value = "";
        el("del_confirm").value = "";
        resetDeleteUI();
        // atualiza lista
        await listUsers();
        selectTab("portal");
        showPortal("register");
      }catch(e){
        toast("Deletar", e.message || String(e));
      }
    }

    async function copyToken(){
      if(!token){
        toast("Token", "Nenhum token para copiar");
        return;
      }
      try{
        await navigator.clipboard.writeText(token);
        toast("Token", "Copiado ‚úÖ");
      }catch(_){
        // fallback
        el("tokenField").focus();
        el("tokenField").select();
        document.execCommand("copy");
        toast("Token", "Copiado ‚úÖ");
      }
    }

    // =========================
    // INIT
    // =========================
    function init(){
      apiBase = normalizeBase(localStorage.getItem(LS_BASE) || "");
      token = (localStorage.getItem(LS_TOKEN) || "").trim();
      renderBase();
      renderToken();

      // tabs
      document.querySelectorAll(".navbtn").forEach(b=>{
        b.addEventListener("click", ()=>{
          selectTab(b.dataset.tab);
          // auto actions
          if(b.dataset.tab === "taverna") listUsers();
          if(b.dataset.tab === "perfil") doWhoami(true);
        });
      });

      // portal switch (2 bot√µes)
      el("btnShowLogin").addEventListener("click", ()=>showPortal("login"));
      el("btnShowRegister").addEventListener("click", ()=>showPortal("register"));

      // top actions
      el("btnSyncStatus").addEventListener("click", async ()=>{
        await syncStatusJson();
      });
      el("btnPing").addEventListener("click", doPing);
      el("btnWhoami").addEventListener("click", ()=>doWhoami(true));

      // portal actions
      el("btnPing2").addEventListener("click", doPing);
      el("btnWhoami2").addEventListener("click", ()=>doWhoami(true));
      el("btnWhoami3").addEventListener("click", ()=>doWhoami(true));
      el("btnDoLogin").addEventListener("click", doLogin);
      el("btnDoRegister").addEventListener("click", doRegister);
      el("btnLogout").addEventListener("click", doLogout);

      el("btnListUsers").addEventListener("click", listUsers);
      el("btnListUsers1").addEventListener("click", listUsers);

      // base + token tools
      el("btnApplyBase").addEventListener("click", ()=>{
        const v = el("apiBaseInput").value;
        setBase(v);
        toast("Base", "Aplicada");
      });
      el("btnClearToken").addEventListener("click", ()=>{
        setToken("");
        toast("Token", "Limpo");
      });

      // profile actions
      el("btnCopyToken").addEventListener("click", copyToken);

      // account actions
      el("btnUpdateProfile").addEventListener("click", updateProfile);
      el("btnChangePassword").addEventListener("click", changePassword);

      el("btnArmDelete").addEventListener("click", armDelete);
      el("btnDeleteAccount").addEventListener("click", deleteAccount);

      // notes
      el("btnRefreshNotes").addEventListener("click", ()=>{
        el("notesStamp").textContent = "Atualizado em " + new Date().toLocaleString("pt-BR");
        toast("Patch Notes", "Atualizado");
      });
      el("notesStamp").textContent = "Atualizado em " + new Date().toLocaleString("pt-BR");

      // reset delete timer on input change
      ["del_pass","del_confirm"].forEach(id=>{
        el(id).addEventListener("input", ()=>resetDeleteUI());
      });

      // auto sync status.json (tenta no boot)
      syncStatusJson();

      // default portal
      showPortal("login");
    }

    init();
  </script>
</body>
</html>
