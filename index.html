<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OBEARCO ‚Ä¢ RPG Hub</title>
  <meta name="color-scheme" content="dark light" />

  <style>
    :root{
      --bg:#07090c;
      --panel: rgba(16,20,26,.72);
      --text:#eaf2ff;
      --muted:#a7b4c7;
      --border: rgba(180,210,255,.12);
      --accent:#5aa6ff;
      --accent2:#8b5cf6;
      --ok:#22c55e;
      --bad:#ef4444;
      --warn:#f59e0b;
      --shadow: 0 18px 65px rgba(0,0,0,.45);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1100px 650px at 15% -10%, rgba(90,166,255,.14), transparent 55%),
                  radial-gradient(900px 650px at 95% 5%, rgba(139,92,246,.14), transparent 55%),
                  var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }
    a{color:inherit; text-decoration:none}

    #bg{
      position:fixed;
      inset:0;
      z-index:-1;
      opacity:.85;
      filter: saturate(1.1);
    }
    .vignette{
      position:fixed;
      inset:0;
      z-index:-1;
      pointer-events:none;
      background: radial-gradient(900px 700px at 50% 35%, transparent 30%, rgba(0,0,0,.55) 78%),
                  linear-gradient(to bottom, rgba(0,0,0,.55), transparent 30%, rgba(0,0,0,.65));
    }

    .app{min-height:100vh; display:flex; flex-direction:column}
    .topbar{
      position:sticky; top:0; z-index:50;
      background: rgba(7,9,12,.65);
      backdrop-filter: blur(12px);
      border-bottom:1px solid var(--border);
    }
    .topbar-inner{
      max-width:1120px;
      margin:0 auto;
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      font-weight:900; letter-spacing:.5px;
    }
    .brand .title{display:flex; flex-direction:column; line-height:1.1}
    .brand .title .sub{font-size:12px; color:var(--muted); font-weight:700}
    .dot{
      width:11px;height:11px;border-radius:999px;
      background:var(--warn);
      box-shadow:0 0 0 6px rgba(245,158,11,.10);
      transition: .25s ease;
    }

    .nav{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      justify-content:flex-end;
    }

    .btn{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      transition: transform .15s ease, filter .15s ease, border-color .15s ease;
      display:inline-flex; align-items:center; gap:8px;
      font-weight:800;
      letter-spacing:.2px;
      user-select:none;
    }
    .btn:hover{transform:translateY(-1px); filter:brightness(1.06); border-color: rgba(180,210,255,.22)}
    .btn.primary{
      border-color: rgba(90,166,255,.32);
      background: linear-gradient(180deg, rgba(90,166,255,.22), rgba(90,166,255,.10));
    }
    .btn.ghost{background:transparent}
    .btn.danger{
      border-color: rgba(239,68,68,.30);
      background: linear-gradient(180deg, rgba(239,68,68,.18), rgba(239,68,68,.08));
    }

    .container{
      max-width:1120px; width:100%;
      margin:0 auto; padding:18px 16px 34px;
      display:grid; gap:16px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      animation: fadeUp .35s ease both;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      position:relative;
      overflow:hidden;
    }
    .card:before{
      content:"";
      position:absolute;
      inset:-1px;
      background: radial-gradient(800px 220px at 20% 0%, rgba(90,166,255,.14), transparent 55%),
                  radial-gradient(800px 220px at 80% 0%, rgba(139,92,246,.12), transparent 55%);
      opacity:.65;
      pointer-events:none;
      mix-blend-mode: screen;
    }
    .card > *{position:relative}
    .card h2{margin:0 0 8px; font-size:18px}
    .muted{color:var(--muted)}
    .mini{font-size:12px}
    .tag{font-family:var(--mono); font-size:12px; opacity:.92}

    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px; border-radius:999px; font-size:12px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      color:var(--muted);
      font-weight:800;
    }
    .pill.ok{border-color: rgba(34,197,94,.32); color:#b7f7cb; background:rgba(34,197,94,.08)}
    .pill.bad{border-color: rgba(239,68,68,.32); color:#ffd0d0; background:rgba(239,68,68,.08)}
    .pill.warn{border-color: rgba(245,158,11,.32); color:#ffe2b3; background:rgba(245,158,11,.08)}

    .hr{height:1px; background:var(--border); margin:12px 0}
    .field{display:flex; flex-direction:column; gap:7px}
    .field label{font-size:12px; color:var(--muted); font-weight:800; letter-spacing:.2px}
    input, textarea

textarea{
      width:100%;
      padding:11px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.22);
      color:var(--text);
      outline:none;
    }
    input:focus, textarea:focus{border-color: rgba(90,166,255,.32); box-shadow: 0 0 0 4px rgba(90,166,255,.10)}

    .kpi{
      display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px;
    }
    @media (max-width: 600px){ .kpi{grid-template-columns:1fr} }
    .kpi .box{
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      border-radius:16px;
      padding:10px;
    }
    .kpi .n{font-weight:950; font-size:16px}
    .kpi .t{font-size:12px; color:var(--muted); font-weight:800}

    .toast-wrap{
      position:fixed; right:16px; bottom:16px; z-index:9999;
      display:flex; flex-direction:column; gap:10px;
      max-width:min(520px, calc(100vw - 32px));
    }
    .toast{
      border:1px solid var(--border);
      background: rgba(7,9,12,.75);
      backdrop-filter: blur(10px);
      border-radius:16px;
      padding:10px 12px;
      box-shadow:var(--shadow);
      display:flex; gap:10px; align-items:flex-start;
      animation: toastIn .22s ease both;
    }
    .toast b{display:block; margin-bottom:2px}
    @keyframes toastIn{from{opacity:0; transform: translateY(8px)} to{opacity:1; transform: translateY(0)}}
    @keyframes fadeUp{from{opacity:0; transform: translateY(6px)} to{opacity:1; transform: translateY(0)}}

    .footer{
      max-width:1120px;
      margin:0 auto 24px;
      padding:0 16px;
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      opacity:.9;
    }
  </style>
</head>

<body>
<canvas id="bg"></canvas>
<div class="vignette"></div>

<div class="app">
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <span class="dot" id="srvDot"></span>
        <div class="title">
          <div>OBEARCO <span class="muted">RPG Hub</span></div>
          <div class="sub" id="srvLine">Carregando status‚Ä¶</div>
        </div>
      </div>

      <div class="nav" id="nav"></div>
    </div>
  </div>

  <main class="container" id="app"></main>

  <div class="footer">
    <div>‚öîÔ∏è OBEARCO ‚Ä¢ UI para p√∫blico (GitHub Pages)</div>
    <div class="muted">Dica: mantenha CORS liberado para o dom√≠nio do seu Pages.</div>
  </div>
</div>

<div class="toast-wrap" id="toasts"></div>

<script>
/* ============================================================
   CONFIG ‚Äî SEMPRE BUSCAR API NO server_status.json DO GITHUB
   ============================================================ */
const STATUS_GITHUB_URL = "https://github.com/NoSense-Bot/Servidor/blob/main/server_status.json";

function githubBlobToRaw(url){
  try{
    const u = String(url||"").trim();
    if(!u) return u;
    if(u.includes("raw.githubusercontent.com")) return u;
    return u.replace("https://github.com/", "https://raw.githubusercontent.com/")
            .replace("/blob/", "/");
  }catch{ return url; }
}

const LS = {
  token: "obearco_session_token",
  me: "obearco_me_cache",
};

const state = {
  status: null,
  apiBase: "",         // n√£o exibimos
  token: localStorage.getItem(LS.token) || "",
  me: safeJson(localStorage.getItem(LS.me)) || null,
  isAdmin: false,
  route: location.hash || "#/login",
};

function safeJson(s){ try{ return JSON.parse(s); }catch{ return null; } }

function escapeHtml(s){
  return String(s ?? "").replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[m]));
}

function toast(title, msg, kind="info"){
  const wrap = document.getElementById("toasts");
  const t = document.createElement("div");
  t.className = "toast";
  const icon = kind==="ok" ? "‚úÖ" : kind==="bad" ? "‚ùå" : kind==="warn" ? "‚ö†Ô∏è" : "‚ÑπÔ∏è";
  t.innerHTML = `
    <div style="font-size:18px;line-height:1">${icon}</div>
    <div>
      <b>${escapeHtml(title)}</b>
      <div class="mini muted">${escapeHtml(msg)}</div>
    </div>
  `;
  wrap.appendChild(t);
  setTimeout(()=>{ t.style.opacity="0"; t.style.transform="translateY(6px)"; }, 3200);
  setTimeout(()=>{ t.remove(); }, 3800);
}

function go(hash){ location.hash = hash; }

function isAdminFromMe(me){
  return !!(me?.is_admin || me?.admin || me?.role === "admin" || me?.nivel === "admin");
}

/* ============================================================
   Status + API base
   ============================================================ */
async function fetchStatusAlways(){
  const rawUrl = githubBlobToRaw(STATUS_GITHUB_URL);
  const res = await fetch(rawUrl, { cache:"no-store" });
  if(!res.ok) throw new Error("N√£o consegui baixar server_status.json");
  return await res.json();
}

function setServerBadge(online){
  const dot = document.getElementById("srvDot");
  const line = document.getElementById("srvLine");
  if(online){
    dot.style.background = "var(--ok)";
    dot.style.boxShadow = "0 0 0 6px rgba(34,197,94,.10)";
    line.textContent = "Servidor: Online ‚úÖ";
  }else{
    dot.style.background = "var(--bad)";
    dot.style.boxShadow = "0 0 0 6px rgba(239,68,68,.10)";
    line.textContent = "Servidor: Offline ‚ùå";
  }
}

function apiUrl(path){
  const base = (state.apiBase || "").replace(/\/+$/,"");
  return base + path;
}

async function apiCmd(payload){
  const url = apiUrl("/api/v1/cmd");
  const headers = { "Content-Type":"application/json" };
  if(state.token) headers["Authorization"] = "Bearer " + state.token;

  // 1) tenta /api/v1/cmd
  try{
    const r = await fetch(url, { method:"POST", headers, body: JSON.stringify(payload) });
    const j = await r.json().catch(()=> ({}));
    if(!r.ok || j.ok === false) throw new Error(j.error || "Falha no cmd");
    return j;
  }catch(err){
    // 2) fallback legacy /login e /register (body sem "comando")
    if(payload?.comando === "/login"){
      const rr = await fetch(apiUrl("/login"), {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
          login: payload.login || payload.email || payload.username || "",
          senha: payload.senha || ""
        })
      });
      const jj = await rr.json().catch(()=> ({}));
      if(!rr.ok || jj.ok === false) throw new Error(jj.error || "Falha no login");
      return jj;
    }

    if(payload?.comando === "/register"){
      const rr = await fetch(apiUrl("/register"), {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
          username: payload.username || "",
          email: payload.email || "",
          senha: payload.senha || ""
        })
      });
      const jj = await rr.json().catch(()=> ({}));
      if(!rr.ok || jj.ok === false) throw new Error(jj.error || "Falha no register");
      return jj;
    }

    throw err;
  }
}

/* ============================================================
   Auth
   ============================================================ */
async function doLogin(email, senha){
  const out = await apiCmd({ comando:"/login", login: email, senha });
  const token = out.session_token || out.token || out?.data?.session_token || out?.session?.token;
  if(!token) throw new Error("Login OK mas n√£o veio session_token");
  state.token = token;
  localStorage.setItem(LS.token, token);
  toast("Login", "Sess√£o salva ‚úÖ", "ok");
  await loadMe();
  go("#/feed");
}

async function doRegister(username, email, senha){
  // ‚úÖ CORRETO: backend espera "username"
  await apiCmd({ comando:"/register", username, email, senha });
  toast("Conta criada", "Agora faz login üòâ", "ok");
  go("#/login");
}

function doLogout(){
  state.token = "";
  state.me = null;
  state.isAdmin = false;
  localStorage.removeItem(LS.token);
  localStorage.removeItem(LS.me);
  toast("Logout", "Sess√£o removida.", "ok");
  go("#/login");
}

/* ============================================================
   Me (CRUD)
   ============================================================ */
async function loadMe(){
  if(!state.token) return null;
  const out = await apiCmd({ comando:"/whoami" }); // se seu Server.py monta payload["session"], use /whoami
  const me = out.me || out.user || out.account || out.data || out.session || out;
  state.me = me;
  state.isAdmin = isAdminFromMe(me);
  localStorage.setItem(LS.me, JSON.stringify(me));
  renderNav();
  return me;
}

/* ============================================================
   Router + Nav
   ============================================================ */
window.addEventListener("hashchange", ()=>{
  state.route = location.hash || "#/login";
  render();
});

function renderNav(){
  const nav = document.getElementById("nav");
  const authed = !!state.token;
  nav.innerHTML = "";

  if(!authed){
    nav.appendChild(btn("üîê Login", ()=>go("#/login"), "primary"));
    nav.appendChild(btn("üßæ Registrar", ()=>go("#/register")));
    return;
  }

  nav.appendChild(btn("üì∞ Feed", ()=>go("#/feed"), "primary"));
  nav.appendChild(btn("üö™ Sair", doLogout, "ghost"));
}

function btn(label, onClick, cls=""){
  const b = document.createElement("button");
  b.className = "btn " + cls;
  b.textContent = label;
  b.onclick = onClick;
  return b;
}

function guardRoute(){
  const r = state.route;
  if(!state.token && (r.startsWith("#/feed"))){
    go("#/login");
    return false;
  }
  return true;
}

function render(){
  if(!guardRoute()) return;

  const app = document.getElementById("app");
  const r = state.route;

  if(r.startsWith("#/login")) return renderLogin(app);
  if(r.startsWith("#/register")) return renderRegister(app);
  if(r.startsWith("#/feed")) return renderFeed(app);

  go("#/login");
}

/* ============================================================
   Views
   ============================================================ */
function renderLogin(app){
  const st = state.status || {};
  app.innerHTML = `
    <div class="grid">
      <div class="card">
        <h2>üîê Login</h2>
        <div class="muted">Entre com sua conta.</div>
        <div class="hr"></div>

        <div class="field">
          <label>Email ou Username</label>
          <input id="email" placeholder="email@exemplo.com" autocomplete="username" />
        </div>
        <div class="field">
          <label>Senha</label>
          <input id="senha" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
        </div>

        <div class="row" style="margin-top:10px">
          <button class="btn primary" id="btnLogin">Entrar</button>
          <button class="btn" onclick="location.hash='#/register'">Criar conta</button>
        </div>

        <div class="hr"></div>
        <div class="mini muted">
          Base da API vem do <span class="tag">server_status.json</span> no GitHub a cada carregamento.
        </div>
      </div>

      <div class="card">
        <h2>üì° Status</h2>
        <div class="kpi">
          <div class="box">
            <div class="n">${escapeHtml(st.status_servidor ?? "‚Äî")}</div>
            <div class="t">status_servidor</div>
          </div>
          <div class="box">
            <div class="n">${escapeHtml(st.version_api ?? "‚Äî")}</div>
            <div class="t">version_api</div>
          </div>
          <div class="box">
            <div class="n">${escapeHtml(st.porta ?? "‚Äî")}</div>
            <div class="t">porta</div>
          </div>
        </div>
      </div>
    </div>
  `;

  const email = app.querySelector("#email");
  const senha = app.querySelector("#senha");
  const btnLogin = app.querySelector("#btnLogin");

  btnLogin.onclick = async ()=>{
    const e = (email.value || "").trim();
    const s = (senha.value || "");
    if(!e || !s){ toast("Ops", "Preenche login e senha üòÖ", "warn"); return; }
    btnLogin.disabled = true; btnLogin.textContent = "Entrando‚Ä¶";
    try{ await doLogin(e, s); }
    catch(err){ toast("Login falhou", err?.message || String(err), "bad"); }
    finally{ btnLogin.disabled = false; btnLogin.textContent = "Entrar"; }
  };
}

function renderRegister(app){
  app.innerHTML = `
    <div class="grid">
      <div class="card">
        <h2>üßæ Registrar</h2>
        <div class="muted">Cria conta de usu√°rio normal.</div>
        <div class="hr"></div>

        <div class="field">
          <label>Usu√°rio (username)</label>
          <input id="username" placeholder="Ex: Gustavo Azevedo" autocomplete="nickname" />
          <div class="mini muted">Permitido: letras/n√∫meros/espa√ßo/_/./- (sem @#!).</div>
        </div>
        <div class="field">
          <label>Email</label>
          <input id="email" placeholder="email@exemplo.com" autocomplete="username" />
        </div>
        <div class="field">
          <label>Senha</label>
          <input id="senha" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password" />
        </div>

        <div class="row" style="margin-top:10px">
          <button class="btn primary" id="btnReg">Criar</button>
          <button class="btn" onclick="location.hash='#/login'">Voltar</button>
        </div>
      </div>

      <div class="card">
        <h2>üß† Seguran√ßa</h2>
        <div class="muted">
          Token fica no <span class="tag">localStorage</span> (bom pra dev).<br/>
          Em produ√ß√£o, prefira cookie HttpOnly.
        </div>
      </div>
    </div>
  `;

  const username = app.querySelector("#username");
  const email = app.querySelector("#email");
  const senha = app.querySelector("#senha");
  const btnReg = app.querySelector("#btnReg");

  btnReg.onclick = async ()=>{
    const u = (username.value || "").trim();
    const e = (email.value || "").trim();
    const s = (senha.value || "");
    if(!u || !e || !s){
      toast("Ops", "Preenche usu√°rio, email e senha üòÖ", "warn");
      return;
    }
    btnReg.disabled = true; btnReg.textContent = "Criando‚Ä¶";
    try{ await doRegister(u, e, s); }
    catch(err){ toast("Registro falhou", err?.message || String(err), "bad"); }
    finally{ btnReg.disabled = false; btnReg.textContent = "Criar"; }
  };
}

function renderFeed(app){
  const me = state.me || {};
  app.innerHTML = `
    <div class="grid">
      <div class="card">
        <h2>üì∞ Feed</h2>
        <div class="muted">Voc√™ est√° logado.</div>
        <div class="hr"></div>

        <div class="row" style="justify-content:space-between">
          <div>
            <div><b>Username:</b> ${escapeHtml(me.username || me.usuario || "‚Äî")}</div>
            <div class="mini muted"><b>Email:</b> ${escapeHtml(me.email || "‚Äî")}</div>
          </div>
          <span class="pill ${state.isAdmin ? "ok" : "warn"}">${state.isAdmin ? "üõ°Ô∏è admin" : "üë§ user"}</span>
        </div>
      </div>

      <div class="card">
        <h2>‚ö° A√ß√µes</h2>
        <div class="row">
          <button class="btn danger" onclick="(${doLogout.toString()})()">üö™ Sair</button>
        </div>
      </div>
    </div>
  `;
}

/* ============================================================
   Boot
   ============================================================ */
async function boot(){
  try{
    renderNav();

    const st = await fetchStatusAlways();
    state.status = st;

    const base = (st?.url_api_base || "").trim();
    if(!base) throw new Error("server_status.json sem url_api_base");
    state.apiBase = base.replace(/\/+$/,"");

    const online = String(st?.status_servidor || "").toLowerCase().includes("online");
    setServerBadge(online);

    if(state.token){
      try{ await loadMe(); }
      catch{ toast("Sess√£o", "Token inv√°lido/expirado. Fa√ßa login de novo üòâ", "warn"); doLogout(); }
    }

    renderNav();
    render();
  }catch(err){
    setServerBadge(false);
    toast("Boot falhou", err?.message || String(err), "bad");
    renderNav();
    render();
  }
}
boot();

/* ============================================================
   Background animado (particles)
   ============================================================ */
(function bgParticles(){
  const canvas = document.getElementById("bg");
  const ctx = canvas.getContext("2d");
  let w=0,h=0, dpr=1;
  let parts=[];
  const N = 70;

  function resize(){
    dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    w = canvas.width = Math.floor(innerWidth * dpr);
    h = canvas.height = Math.floor(innerHeight * dpr);
    canvas.style.width = innerWidth + "px";
    canvas.style.height = innerHeight + "px";
  }
  window.addEventListener("resize", resize, {passive:true});
  resize();

  function rnd(a,b){ return a + Math.random()*(b-a); }

  function seed(){
    parts = [];
    for(let i=0;i<N;i++){
      parts.push({
        x: rnd(0,w),
        y: rnd(0,h),
        r: rnd(0.8*dpr, 2.4*dpr),
        vx: rnd(-0.18, 0.18)*dpr,
        vy: rnd(-0.12, 0.12)*dpr,
        a: rnd(0.10, 0.22),
        hue: Math.random() < 0.55 ? 210 : 265
      });
    }
  }
  seed();

  function step(){
    ctx.clearRect(0,0,w,h);

    const g = ctx.createRadialGradient(w*0.3, h*0.2, 0, w*0.3, h*0.2, Math.max(w,h)*0.7);
    g.addColorStop(0, "rgba(90,166,255,.08)");
    g.addColorStop(1, "rgba(0,0,0,0)");
    ctx.fillStyle = g; ctx.fillRect(0,0,w,h);

    const g2 = ctx.createRadialGradient(w*0.8, h*0.25, 0, w*0.8, h*0.25, Math.max(w,h)*0.75);
    g2.addColorStop(0, "rgba(139,92,246,.08)");
    g2.addColorStop(1, "rgba(0,0,0,0)");
    ctx.fillStyle = g2; ctx.fillRect(0,0,w,h);

    for(const p of parts){
      p.x += p.vx; p.y += p.vy;
      if(p.x < -20) p.x = w+20;
      if(p.x > w+20) p.x = -20;
      if(p.y < -20) p.y = h+20;
      if(p.y > h+20) p.y = -20;

      ctx.beginPath();
      ctx.fillStyle = `hsla(${p.hue}, 90%, 65%, ${p.a})`;
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fill();
    }

    requestAnimationFrame(step);
  }
  step();
})();
</script>
</body>
</html>
